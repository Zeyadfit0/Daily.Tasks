<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Daily Tasks ğŸ’«</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="manifest" href="manifest.json">

  <style>
    :root {
      --bg: #f4f6fb;
      --card: #ffffff;
      --text: #222;
      --primary: #5b6cff;
      --secondary: #8f9bff;
    }
    body.dark { --bg: #0f1220; --card: #1b1f3a; --text: #f1f1f1; }
    body {
      margin: 0; min-height: 100vh; background: var(--bg);
      font-family: 'Segoe UI', Tahoma, sans-serif;
      display: flex; justify-content: center; align-items: flex-start; padding: 20px;
    }
    .app { width: 100%; max-width: 480px; background: var(--card); border-radius: 24px;
      padding: 20px; box-shadow: 0 25px 60px rgba(0,0,0,0.25); display: flex; flex-direction: column; }
    .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-wrap: wrap; }
    h1 { margin: 0; font-size: 22px; color: var(--text); }
    .toggle { width: 36px; height: 36px; border-radius: 50%; border: none; cursor: pointer; background: var(--primary); color: #fff; }
    .input-group { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
    input, select { flex: 1; padding: 12px; border-radius: 14px; border: none; outline: none; font-size: 15px; background: #eceefe; }
    body.dark input, body.dark select { background: #2a2f55; color: white; }
    .add-btn { padding: 12px 18px; border-radius: 14px; border: none; cursor: pointer; background: var(--primary); color: white; }
    .task { background: rgba(0,0,0,0.05); padding: 12px; border-radius: 14px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; color: var(--text); cursor: grab; transition: 0.2s; word-break: break-word; }
    .task.dragging { opacity: 0.5; }
    body.dark .task { background: rgba(255,255,255,0.08); }
    .task.done { opacity: 0.5; text-decoration: line-through; }
    .task-actions { display: flex; gap: 6px; }
    .task-actions button { border: none; border-radius: 8px; padding: 5px 10px; cursor: pointer; color: white; }
    .done-btn { background: #4CAF50; }
    .delete-btn { background: #e74c3c; }
    .progress-box { margin-top: 20px; }
    .progress-bar { height: 14px; background: #ddd; border-radius: 10px; overflow: hidden; }
    .progress { height: 100%; width: 0%; background: linear-gradient(90deg, var(--primary), var(--secondary)); transition: width 0.3s ease; }
    .progress-text { text-align: center; margin-top: 8px; font-size: 14px; color: var(--text); }
    .clear-buttons { display: flex; gap: 10px; margin-top: 10px; justify-content: center; flex-wrap: wrap; }
    .footer { text-align: center; margin-top: 20px; font-size: 12px; color: var(--text); opacity: 0.7; }
    body.dark .footer { color: #ccc; }
  </style>
</head>
<body>
  <div class="app">
    <div class="header">
      <h1>Daily Tasks ğŸ’«</h1>
      <button class="toggle" onclick="toggleDark()">ğŸŒ™</button>
    </div>

    <div class="input-group">
      <select id="monthSelect" onchange="render()">
        <option value="ÙŠÙ†Ø§ÙŠØ±">ÙŠÙ†Ø§ÙŠØ±</option>
        <option value="ÙØ¨Ø±Ø§ÙŠØ±">ÙØ¨Ø±Ø§ÙŠØ±</option>
        <option value="Ù…Ø§Ø±Ø³">Ù…Ø§Ø±Ø³</option>
        <option value="Ø£Ø¨Ø±ÙŠÙ„">Ø£Ø¨Ø±ÙŠÙ„</option>
        <option value="Ù…Ø§ÙŠÙˆ">Ù…Ø§ÙŠÙˆ</option>
        <option value="ÙŠÙˆÙ†ÙŠÙˆ">ÙŠÙˆÙ†ÙŠÙˆ</option>
        <option value="ÙŠÙˆÙ„ÙŠÙˆ">ÙŠÙˆÙ„ÙŠÙˆ</option>
        <option value="Ø£ØºØ³Ø·Ø³">Ø£ØºØ³Ø·Ø³</option>
        <option value="Ø³Ø¨ØªÙ…Ø¨Ø±">Ø³Ø¨ØªÙ…Ø¨Ø±</option>
        <option value="Ø£ÙƒØªÙˆØ¨Ø±">Ø£ÙƒØªÙˆØ¨Ø±</option>
        <option value="Ù†ÙˆÙÙ…Ø¨Ø±">Ù†ÙˆÙÙ…Ø¨Ø±</option>
        <option value="Ø¯ÙŠØ³Ù…Ø¨Ø±">Ø¯ÙŠØ³Ù…Ø¨Ø±</option>
      </select>

      <select id="weekSelect" onchange="render()">
        <option value="Ø£Ø³Ø¨ÙˆØ¹ 1">Ø£Ø³Ø¨ÙˆØ¹ 1</option>
        <option value="Ø£Ø³Ø¨ÙˆØ¹ 2">Ø£Ø³Ø¨ÙˆØ¹ 2</option>
        <option value="Ø£Ø³Ø¨ÙˆØ¹ 3">Ø£Ø³Ø¨ÙˆØ¹ 3</option>
        <option value="Ø£Ø³Ø¨ÙˆØ¹ 4">Ø£Ø³Ø¨ÙˆØ¹ 4</option>
      </select>

      <select id="daySelect" onchange="render()">
        <option value="Ø§Ù„Ø³Ø¨Øª">Ø§Ù„Ø³Ø¨Øª</option>
        <option value="Ø§Ù„Ø£Ø­Ø¯">Ø§Ù„Ø£Ø­Ø¯</option>
        <option value="Ø§Ù„Ø§Ø«Ù†ÙŠÙ†">Ø§Ù„Ø§Ø«Ù†ÙŠÙ†</option>
        <option value="Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡">Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡</option>
        <option value="Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡">Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡</option>
        <option value="Ø§Ù„Ø®Ù…ÙŠØ³">Ø§Ù„Ø®Ù…ÙŠØ³</option>
        <option value="Ø§Ù„Ø¬Ù…Ø¹Ø©">Ø§Ù„Ø¬Ù…Ø¹Ø©</option>
      </select>

      <input id="taskInput" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ù…Ù‡Ù…Ø©" />
      <button class="add-btn" onclick="addTask()">+</button>
    </div>

    <div id="taskList"></div>

    <div class="progress-box">
      <div class="progress-bar">
        <div class="progress" id="progress"></div>
      </div>
      <div class="progress-text" id="progressText">0% Ø¥Ù†Ø¬Ø§Ø²</div>
    </div>

    <div class="clear-buttons">
      <button class="add-btn" onclick="clearDay()">Ù…Ø³Ø­ Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…</button>
      <button class="add-btn" onclick="clearAll()">Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø£ÙŠØ§Ù…</button>
    </div>

    <div class="footer">ØªÙ… Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø¨ÙˆØ§Ø³Ø·Ø© Zeyad Ahmed âš¡</div>
  </div>

  <script>
    let data = JSON.parse(localStorage.getItem('monthlyData')) || { months:{} };

    function save() {
      localStorage.setItem('monthlyData', JSON.stringify(data));
      localStorage.setItem('dark', document.body.classList.contains('dark'));
      localStorage.setItem('lastSelection', JSON.stringify({
        month: document.getElementById('monthSelect').value,
        week: document.getElementById('weekSelect').value,
        day: document.getElementById('daySelect').value
      }));
    }

    // Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø¢Ø®Ø± Ø§Ø®ØªÙŠØ§Ø±
    const last = JSON.parse(localStorage.getItem('lastSelection'));
    if (last) {
      document.getElementById('monthSelect').value = last.month;
      document.getElementById('weekSelect').value = last.week;
      document.getElementById('daySelect').value = last.day;
    }

    function render() {
      const month = document.getElementById('monthSelect').value;
      const week = document.getElementById('weekSelect').value;
      const day = document.getElementById('daySelect').value;
      const list = document.getElementById('taskList');
      list.innerHTML = '';

      if(!data.months[month]) data.months[month] = {};
      if(!data.months[month][week]) data.months[month][week] = {};
      if(!data.months[month][week][day]) data.months[month][week][day] = [];

      const tasks = data.months[month][week][day];

      tasks.forEach((task,i)=>{
        const div = document.createElement('div');
        div.className = 'task'+(task.done?' done':'');
        div.draggable = true;
        div.dataset.index = i;
        div.innerHTML = `
          <span>${task.text}</span>
          <div class="task-actions">
            <button class="done-btn" onclick="finishTask(${i},'${month}','${week}','${day}')">âœ”</button>
            <button class="delete-btn" onclick="deleteTask(${i},'${month}','${week}','${day}')">ğŸ—‘</button>
          </div>
        `;
        list.appendChild(div);
      });

      enableDrag();
      updateProgress();
    }

    function addTask(){
      const month = document.getElementById('monthSelect').value;
      const week = document.getElementById('weekSelect').value;
      const day = document.getElementById('daySelect').value;
      const input = document.getElementById('taskInput');
      if(!input.value.trim()) return;

      if(!data.months[month]) data.months[month] = {};
      if(!data.months[month][week]) data.months[month][week] = {};
      if(!data.months[month][week][day]) data.months[month][week][day] = [];
      data.months[month][week][day].push({text: input.value, done:false});
      input.value='';
      save();
      render();
    }

    function finishTask(i,month,week,day){
      data.months[month][week][day][i].done = !data.months[month][week][day][i].done;
      save();
      render();
    }

    function deleteTask(i,month,week,day){
      data.months[month][week][day].splice(i,1);
      save();
      render();
    }

    function updateProgress(){
      const month = document.getElementById('monthSelect').value;
      const week = document.getElementById('weekSelect').value;
      const day = document.getElementById('daySelect').value;
      const tasks = data.months[month]?.[week]?.[day] || [];
      const done = tasks.filter(t=>t.done).length;
      const percent = tasks.length? Math.round((done/tasks.length)*100):0;
      document.getElementById('progress').style.width = percent+'%';
      document.getElementById('progressText').innerText = percent+'% Ø¥Ù†Ø¬Ø§Ø²';
    }

    function toggleDark(){
      document.body.classList.toggle('dark');
      save();
    }

    function enableDrag(){
      const tasks = document.querySelectorAll('.task');
      let draggedIndex=null;
      tasks.forEach(task=>{
        task.addEventListener('dragstart',e=>{
          draggedIndex=+task.dataset.index;
          task.classList.add('dragging');
        });
        task.addEventListener('dragend',()=>{ task.classList.remove('dragging'); });
        task.addEventListener('dragover', e=> e.preventDefault());
        task.addEventListener('drop', e=>{
          const month = document.getElementById('monthSelect').value;
          const week = document.getElementById('weekSelect').value;
          const day = document.getElementById('daySelect').value;
          const targetIndex = +task.dataset.index;
          const draggedItem = data.months[month][week][day].splice(draggedIndex,1)[0];
          data.months[month][week][day].splice(targetIndex,0,draggedItem);
          save();
          render();
        });
      });
    }

    function clearDay(){
      const month = document.getElementById('monthSelect').value;
      const week = document.getElementById('weekSelect').value;
      const day = document.getElementById('daySelect').value;
      if(data.months[month]?.[week]) delete data.months[month][week][day];
      save();
      render();
    }

    function clearAll(){
      data.months={};
      save();
      render();
    }

    if(localStorage.getItem('dark')==='true'){
      document.body.classList.add('dark');
    }

    render();

    // âœ… Service Worker registration
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js').then(() => {
        console.log('Service Worker registered');
      });
    }
  </script>
</body>
</html>
